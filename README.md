# paywall-ab-skill

An AI agent skill to automate RevenueCat Paywall A/B testing with a 3-day human-in-the-loop check-in loop.

> ‚ö†Ô∏è **Honest disclaimer before you install:**
> - Paywall design is generated by **RevenueCat's built-in AI** (not custom)
> - CVR / conversion data **cannot be fetched automatically** ‚Äî RC API doesn't expose experiment analytics. You check the RC Dashboard yourself.
> - Starting an experiment **requires clicking Start in RC Dashboard** ‚Äî RC API has no endpoint for creating experiments.
> - Every 3 days, the agent Slacks you: *"Please go check your RC Dashboard"*. That's it. You report the winner back.

---

## What it actually does

| Mode | Trigger | What happens |
|------|---------|-------------|
| `setup` | "Start a paywall A/B test" | Creates RC Offering via API ‚Üí RC AI generates Paywall ‚Üí Asks YOU to create Experiment in RC Dashboard ‚Üí Registers 3-day cron |
| `check_in` | Every 3 days at 7am (cron) | Sends Slack: "Go check RC Dashboard. Report A wins / B wins / not yet" |
| `analyze` | You reply "A wins" or "B wins" | Fetches offering details ‚Üí LLM analyzes why winner won ‚Üí Generates 3 new copy variants ‚Üí Posts to Slack |
| `create_variant` | You pick variant 1/2/3 | Creates new RC Offering + Paywall (RC AI) ‚Üí Asks YOU to start new experiment in RC Dashboard |

---

## Prerequisites

### 1. OpenClaw agent framework
This skill runs inside [OpenClaw](https://openclaw.ai). You need an OpenClaw agent running.

```bash
# Install OpenClaw
npm install -g openclaw
openclaw init
```

### 2. RevenueCat account + MCP
- RevenueCat project with Experiments enabled
- RevenueCat MCP configured in your OpenClaw agent
- Required: `REVENUECAT_V2_SECRET_KEY` in your `.env`

### 3. Slack App (Bot Token + App Token)
Required for check-in notifications and the approval button in `create_variant`.

```
SLACK_BOT_TOKEN=xoxb-...
SLACK_APP_TOKEN=xapp-...   ‚Üê Required for Socket Mode (approval buttons)
SLACK_METRICS_CHANNEL=C...  ‚Üê Channel ID where notifications are posted
```

Create your Slack App at https://api.slack.com/apps:
- Enable **Socket Mode**
- Add Bot Scopes: `chat:write`, `chat:update`
- Install to workspace ‚Üí copy Bot Token and App Token

### 4. Node.js (for slack-approval)
```bash
node --version  # v18+ required
cd slack-approval/scripts && npm install
```

### 5. Pencil MCP (optional ‚Äî only for `create_variant` mode)
Used to update paywall text in `.pen` files. If not configured, `create_variant` falls back to RC AI generation.

---

## Installation

### Option A: Clone directly
```bash
git clone https://github.com/Daisuke134/paywall-ab-skill.git
cp -r paywall-ab-skill ~/.openclaw/skills/paywall-ab
cp -r paywall-ab-skill/slack-approval ~/.openclaw/skills/slack-approval
cd ~/.openclaw/skills/slack-approval/scripts && npm install
```

### Option B: OpenClaw skill install (if published to registry)
```bash
npx skills install paywall-ab
```

---

## Configuration

### 1. Copy and fill in apps.json
```bash
cp apps.json.template ~/.openclaw/workspace/paywall-ab/apps.json
```

Edit `apps.json` with your actual IDs (same schema as `apps.json.template`):
```json
{
  "apps": {
    "your_app": {
      "rc_project_id": "projXXXXXXXX",
      "mixpanel_project_id": 0,
      "default_offering_id": "ofrngXXXXXXXX",
      "monthly_product_id": "prodXXXXXXXX",
      "slack_channel": "CXXXXXXXXXX",
      "active_experiment": {
        "experiment_id": "prexpXXXXXXXX",
        "variant_a_offering_id": "ofrngXXXXXXXX",
        "variant_b_offering_id": "ofrngXXXXXXXX",
        "start_date": "YYYY-MM-DD"
      }
    }
  }
}
```

Find these IDs:
- `rc_project_id` ‚Üí RC Dashboard URL: `app.revenuecat.com/projects/YOUR_ID`
- `default_offering_id` ‚Üí RC Dashboard ‚Üí Offerings
- `monthly_product_id` ‚Üí RC Dashboard ‚Üí Products
- `slack_channel` ‚Üí Right-click channel in Slack ‚Üí Copy channel ID
- `active_experiment` ‚Üí Fill in after running `setup` mode and creating the RC Experiment

### 2. Set environment variables in `~/.openclaw/.env`
```bash
REVENUECAT_V2_SECRET_KEY=...
OPENAI_API_KEY=sk-...
SLACK_BOT_TOKEN=xoxb-...
SLACK_APP_TOKEN=xapp-...        ‚Üê Required for Socket Mode (approval buttons)
SLACK_METRICS_CHANNEL=CXXXXXXXXXX
SLACK_APPROVER_USER_IDS=UXXXXXXXXXX  ‚Üê Slack user IDs allowed to click approval buttons (comma-separated)
```

### 3. Register the cron job
After running `setup` mode, the agent automatically registers the 3-day cron. Or add manually to `~/.openclaw/cron/jobs.json`:

```json
{
  "id": "paywall-ab",
  "schedule": { "kind": "cron", "expr": "0 7 */3 * *", "tz": "Asia/Tokyo" },
  "payload": {
    "kind": "agentTurn",
    "message": "Run paywall-ab skill in check_in mode. app_id: your_app. apps_config: ~/.openclaw/workspace/paywall-ab/apps.json"
  },
  "enabled": true
}
```

---

## Usage

### Start a new experiment
Tell your agent:
```
Start a paywall A/B test for my app
```

The agent will:
1. Create a new RC Offering via API
2. Generate a Paywall using RC's built-in AI
3. Post instructions to Slack: *"Please go to RC Dashboard and create an Experiment with these two offerings, then send me the experiment ID"*
4. After you provide the experiment ID ‚Üí registers the 3-day cron

### 3-day loop
Every 3 days at 7am, you get a Slack message:
```
üìä Paywall Experiment Day 3

Variant A: [current offering name]
Variant B: [test offering name]

Please check CVR at: https://app.revenuecat.com/...

Reply: "A wins" / "B wins" / "not yet"
```

You check the dashboard ‚Üí reply ‚Üí the loop continues.

### After you report a winner
The agent analyzes why the winner outperformed and generates 3 new copy variants for the next experiment. You pick one, it creates the new Offering, and asks you to start the new experiment in RC Dashboard.

---

## Repository structure

```
paywall-ab-skill/
‚îú‚îÄ‚îÄ README.md                    ‚Üê This file
‚îú‚îÄ‚îÄ SKILL.md                     ‚Üê Main skill (all 4 modes)
‚îú‚îÄ‚îÄ apps.json.template           ‚Üê Configuration template
‚îî‚îÄ‚îÄ slack-approval/
    ‚îú‚îÄ‚îÄ SKILL.md                 ‚Üê Approval utility skill
    ‚îî‚îÄ‚îÄ scripts/
        ‚îú‚îÄ‚îÄ approve.js           ‚Üê Node.js Block Kit approval
        ‚îî‚îÄ‚îÄ package.json        ‚Üê npm: @slack/web-api, @slack/socket-mode
```

---

## MCP tools used

| Tool | Purpose |
|------|---------|
| `mcp__revenuecat__mcp_RC_create_offering` | Create new Offering |
| `mcp__revenuecat__mcp_RC_create_package` | Attach package to Offering |
| `mcp__revenuecat__mcp_RC_attach_products_to_package` | Link product to package |
| `mcp__revenuecat__mcp_RC_create_design_system_paywall_generation_job` | Generate Paywall via RC AI |
| `mcp__revenuecat__mcp_RC_list_offerings` | Fetch offering details |
| `mcp__pencil__*` | Update paywall text (optional) |

RevenueCat MCP setup: https://docs.revenuecat.com/docs/mcp

---

## License

MIT
